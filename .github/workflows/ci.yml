name: Java CI with Gradle  # ì›Œí¬í”Œë¡œìš° ì´ë¦„

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]  # main ë¸Œëœì¹˜ ëŒ€ìƒ PR ìƒì„±/ì—…ë°ì´íŠ¸ ì‹œ ì‹¤í–‰

jobs:
  build:  # buildë¼ëŠ” Job ë‹¨ìœ„ ì •ì˜
    runs-on: ubuntu-latest  # GitHubê°€ ì œê³µí•˜ëŠ” ìµœì‹  Ubuntu Runner ì‚¬ìš©
    permissions:
      contents: read  # ê¸°ë³¸ ì½”ë“œ ì ‘ê·¼ ê¶Œí•œë§Œ ì„¤ì • (ë³´ì•ˆì ìœ¼ë¡œ ì•ˆì „)
      pull-requests: write  # ì½”ë©˜íŠ¸ ì‘ì„± ìœ„í•´ í•„ìš”
      checks: write  # ì¶”ê°€ ê¶Œí•œìœ¼ë¡œ ì²´í¬ ì‹¤í–‰

    steps:
      - uses: actions/checkout@v4  # ì €ì¥ì†Œ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'         # JDK 17 ì„¤ì¹˜
          distribution: 'corretto'   # Amazon Corretto JDK ì‚¬ìš©

      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4  # Gradle ì„¤ì • + ìºì‹œ ìë™í™”

      - name: Build with Gradle Wrapper
        run: ./gradlew clean test  # ì‹¤ì œ Gradle ë¹Œë“œ ì‹¤í–‰ (Wrapper ì‚¬ìš©)

      - name: Report Test Results
        uses: dorny/test-reporter@v1
        if: always()
        with:
          name: JUnit Tests
          path: build/test-results/test/*.xml
          reporter: java-junit

      - name: ğŸ’¬ Comment test summary on PR
        uses: mikepenz/action-junit-report@v4
        if: github.event_name == 'pull_request'
        with:
          report_paths: '**/build/test-results/test/TEST-*.xml'
          github_token: ${{ secrets.GITHUB_TOKEN }}
